class Collection{constructor(){this.selectors={section:".facest-filters-section",toolbar:".m-collection-toolbar",switcherButtons:[".m-collection-toolbar__column-switcher button"],productContainer:"[data-product-container]",loadMoreBtn:"[data-load-more]",sidebar:".m-sidebar",sidebarContent:".m-sidebar__content",openSidebar:".m-filter-button",closeSidebar:".m-sidebar__close",filtersWrapper:".m-sidebar__filter"},this.mobileSortingSelectors={openSorting:".m-sortby-button",closeSorting:".m-sortby-mobile__close",sortingWrapper:".m-sortby-mobile__wrapper",sortingList:".m-sortby-mobile__content"},this.sectionId="",this.isDesignMode=MinimogSettings.design_mode,this.currentPage=1,this.paginationType,this.totalPages,this.totalProducts,this.infiniteLoadingObserver,this.enableLayoutSwitchers,this.cachedLayout,this.initialLayout,this.activeLayout,this.STORAGE_KEY="m:collection-layout",this.enableFilters,this.enableSorting,this.filtersPosition,this.accordions,this.sideEffectEventsAdded=!1}init=()=>{this.domNodes=queryDomNodes(this.selectors),this.mbSortingNodes=queryDomNodes(this.mobileSortingSelectors),this.setData(),this.initGridView(),this.initFilters(),this.initMobileSorting(),this.initProducts(),this.sideEffectEventsAdded=!0,MinimogEvents.subscribe("ON_PRODUCT_LIST_UPDATED",()=>refreshProductReview()),this.handleStickyToolbar(),document.addEventListener("matchMobile",()=>this.handleStickyToolbar()),document.addEventListener("unmatchMobile",()=>this.handleStickyToolbar())};setData=()=>{const{section,productContainer}=this.domNodes;this.sectionId=section.dataset.sectionId,this.paginationType=section.dataset.paginationType,this.totalPages=productContainer&&Number(productContainer.dataset.totalPages),this.view=section.dataset.view,this.activeLayout=null,this.currentPage=1,this.initialLayout=section.dataset.layout,this.cachedLayout=window.localStorage.getItem(this.STORAGE_KEY)||this.initialLayout,this.enableLayoutSwitchers=section.dataset.enableLayoutSwitchers==="true",this.enableFilters=section.dataset.enableFilters==="true",this.enableSorting=section.dataset.enableSorting==="true",this.filtersPosition=section.dataset.filtersPosition};initGridView=()=>{this.toggleView(this.isDesignMode?this.initialLayout:this.cachedLayout),addEventDelegate({selector:this.selectors.switcherButtons[0],context:this.domNodes.toolbar,handler:(e,colNode)=>this.toggleView(colNode.dataset.layout)}),this.initLoadMore()};initFilters=()=>{if(!this.enableFilters)return;const{sidebar,openSidebar,closeSidebar}=this.domNodes;window.requestAnimationFrame(this.initAccordions),openSidebar&&openSidebar.addEventListener("click",this.openSidebarFilter),closeSidebar.addEventListener("click",this.closeSidebarFilter),sidebar.addEventListener("click",e=>e.target===sidebar&&this.closeSidebarFilter())};initMobileSorting=()=>{if(!this.enableSorting)return;const{openSorting,closeSorting,sortingWrapper}=this.mbSortingNodes;openSorting.addEventListener("click",this.openMobileSorting),closeSorting.addEventListener("click",this.closeMobileSorting),sortingWrapper.addEventListener("click",e=>e.target===sortingWrapper&&this.closeMobileSorting())};openMobileSorting=()=>{const{sortingWrapper,sortingList}=this.mbSortingNodes;sortingWrapper.style.display="block",window.requestAnimationFrame(()=>{sortingWrapper.style.setProperty("--m-bg-opacity","0.5"),sortingList.style.setProperty("--m-translate-y","0")})};closeMobileSorting=e=>{const{sortingWrapper,sortingList}=this.mbSortingNodes;sortingWrapper.style.setProperty("--m-bg-opacity","0"),sortingList.style.setProperty("--m-translate-y","100%"),setTimeout(()=>sortingWrapper.style.setProperty("display","none"),300)};initAccordions=()=>{this.accordions&&this.accordions.destroy();const{filtersWrapper}=this.domNodes;filtersWrapper.classList.remove("acc-initialized"),this.accordions=new MinimogLibs.Accordion(filtersWrapper,{presetContentHeight:window.innerWidth>1280&&this.filtersPosition!=="fixed",callback:()=>filtersWrapper.style.setProperty("opacity","1")})};openSidebarFilter=()=>{const{sidebar,sidebarContent,section}=this.domNodes;sidebar.style.display="block",window.requestAnimationFrame(()=>{sidebar.style.setProperty("--m-bg-opacity","0.5"),sidebarContent.style.setProperty("--m-translate-x","0"),this.accordions&&this.accordions.setContentHeight()}),section.classList.add("sidebar-open")};closeSidebarFilter=()=>{const{sidebar,sidebarContent,section}=this.domNodes;section.classList.remove("sidebar-open"),(window.innerWidth<1280||sidebar.dataset.type==="fixed")&&(sidebarContent.style.setProperty("--m-translate-x","-100%"),sidebar.style.removeProperty("--m-bg-opacity"),setTimeout(()=>sidebar.style.removeProperty("display"),300))};toggleView=layout=>{if(!layout||this.view==="search")return;const{switcherButtons,productContainer}=this.domNodes;if(!productContainer)return;const allImages=productContainer.querySelectorAll("responsive-image");allImages&&allImages.length>0&&allImages.forEach(img=>{img.disconnectedCallback(),img.connectedCallback()});const activeLayout=this.activeLayout||this.initialLayout;this.enableLayoutSwitchers&&switcherButtons.forEach(btn=>{const view=btn.dataset.layout,method=layout==view?"add":"remove";btn.classList[method]("active")}),productContainer.classList.remove(`m-collection-products--${activeLayout}`),productContainer.classList.add(`m-collection-products--${layout}`);const allProductCards=productContainer.querySelectorAll(".m-product-card");allProductCards&&allProductCards.forEach(card=>{layout=="list"?card.classList.contains("m-product-card--view-grid")&&card.classList.remove("m-product-card--view-grid"):card.classList.contains("m-product-card--view-grid")||card.classList.add("m-product-card--view-grid")}),window.localStorage.setItem(this.STORAGE_KEY,layout),this.activeLayout=layout};getDeviceByScreenSize=()=>window.innerWidth<768?"mobile":window.innerWidth<1024?"tablet":"desktop";initLoadMore=()=>{if(this.paginationType==="paginate"||this.totalPages<=1||this.view==="search")return;const{loadMoreBtn}=this.domNodes;loadMoreBtn.addEventListener("click",this.loadMoreProducts),this.paginationType==="infinite"&&(this.infiniteLoadingObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{entry.intersectionRatio===1&&this.loadMoreProducts()})},{threshold:1}),this.infiniteLoadingObserver.observe(loadMoreBtn))};loadMoreProducts=()=>{const nextPage=this.currentPage+1;if(nextPage>this.totalPages)return;const{productContainer,loadMoreBtn}=this.domNodes;this.toggleLoading(!0),fetchSection(this.sectionId,{fromCache:!0,params:{page:nextPage}}).then(productGridHTML=>{productGridHTML.querySelectorAll("[data-product-container] .m-product-item").forEach(prodNode=>productContainer.appendChild(prodNode)),this.initProducts()}).catch(err=>console.error("Failed to load more products.",err)).finally(()=>{MinimogEvents.emit("ON_PRODUCT_LIST_UPDATED"),this.toggleLoading(!1),this.currentPage=nextPage,nextPage>=this.totalPages&&(loadMoreBtn.parentNode.remove(),this.infiniteLoadingObserver&&this.infiniteLoadingObserver.unobserve(loadMoreBtn))})};initProducts=()=>{MinimogTheme.CompareProduct&&MinimogTheme.CompareProduct.setCompareButtonsState(),MinimogTheme.Wishlist&&MinimogTheme.Wishlist.setWishlistButtonsState()};toggleLoading=loading=>{const{loadMoreBtn}=this.domNodes;if(loadMoreBtn){const method=loading?"add":"remove";loadMoreBtn.classList[method]("m-spinner-loading")}};handleStickyToolbar(){const toolbar=this.domNodes.toolbar,extraSpace=toolbar&&toolbar.getBoundingClientRect().top;let lastScroll=0;window.addEventListener("scroll",()=>{if(MinimogTheme.config.mqlMobile){const currentScroll=window.scrollY;if(currentScroll<=extraSpace){toolbar.classList.remove("scroll-up","m-collection-toolbar--sticky");return}toolbar.classList.add("m-collection-toolbar--sticky"),currentScroll>toolbar.offsetHeight+extraSpace&&currentScroll>lastScroll&&!toolbar.classList.contains("scroll-down")?(toolbar.classList.remove("scroll-up"),toolbar.classList.add("scroll-down")):currentScroll<lastScroll&&toolbar.classList.contains("scroll-down")&&(toolbar.classList.remove("scroll-down"),toolbar.classList.add("scroll-up")),lastScroll=currentScroll}else toolbar.classList.remove("scroll-up","m-collection-toolbar--sticky","scroll-down")})}}
//# sourceMappingURL=/cdn/shop/t/5/assets/collection.js.map?v=99211039042400704781728918272
