if(!customElements.get("variant-picker")){class VariantPicker extends HTMLElement{constructor(){super(),this.selectors={container:"[data-variant-picker]",productInfo:".m-product-info--wrapper",error:".m-product-form-message",variantIdInput:'[name="id"]',pickerFields:["[data-picker-field]"],optionNodes:[".m-product-option--node"],productSku:"[data-variant-sku]",productAvailability:"[data-availability]",shareUrlInput:"[data-share-url]",stockCountdown:".prod__stock-countdown",productWrapper:".m-main-product__wrapper"},this.container=this.closest(this.selectors.container),this.productWrapper=this.closest(this.selectors.productWrapper),this.productInfo=this.closest(this.selectors.productInfo),this.domNodes=queryDomNodes(this.selectors,this.productInfo)}connectedCallback(){this.setupData()}async setupData(){let productData=(window._themeProducts||{})[this.container.dataset.productId];this.productId=this.container.dataset.productId,this.sectionId=this.container.dataset.section,this.productUrl=this.container.dataset.productUrl,this.productHandle=this.container.dataset.productHandle,this.section=this.container.closest(`[data-section-id="${this.sectionId}"]`),this.variantData=this.getVariantData(),this.productData=Object.assign(await this.getProductJson(),productData),this.showFeaturedMedia=this.dataset.showFeaturedMedia==="true",this.enableVariantGroupImages=this.container.dataset.enableVariantGroupImages==="true",this.enableVariantGroupImages&&(this.variantGroupImages=this.getVariantGroupImageData());const selectedVariantId=this.productInfo.querySelector(this.selectors.variantIdInput).value;this.currentVariant=this.productData.variants.find(variant=>variant.id===Number(selectedVariantId)),this.productData.current_variant_id=this.currentVariant&&this.currentVariant.id,this.productData.initialVariant=this.currentVariant,this.currentVariant&&(this.getDataImageVariant(this.currentVariant.id),this.hideSoldOutAndUnavailableOptions(),this.updateButton(!this.currentVariant.available,"",!1)),this.getMediaGallery(),document.addEventListener("matchMobile",()=>{this.getMediaGallery()}),document.addEventListener("unmatchMobile",()=>{this.getMediaGallery()}),this.initOptionSwatches(),this.addEventListener("change",this.onVariantChange)}getMediaGallery(){this.mediaGallery=this.section.querySelectorAll("media-gallery"),this.check=setInterval(()=>{this.mediaGallery&&this.mediaGallery.forEach(media=>{window.getComputedStyle(media).display!=="none"&&media.mediaMode&&(clearInterval(this.check),this.layout=media.layout,this.media=media,media.mediaMode==="slider"?(this.slides=media.slider.slides,media.navSlider&&(this.slidesNav=media.navSlider.slides)):this.mediaItems=media.querySelectorAll(".m-product-media--item"),(!this.showFeaturedMedia||this.enableVariantGroupImages&&this.variantGroupImages.enable)&&this.updateMedia())})},100)}onVariantChange(){this.getSelectedOptions(),this.getSelectedVariant(),this.updateButton(!0,"",!1),this.updatePickupAvailability(),this.removeErrorMessage(),this.currentVariant?(this.getDataImageVariant(this.currentVariant.id),this.updateMedia(),this.updateBrowserHistory(),this.updateVariantInput(),this.updateProductMeta(),this.updatePrice(),this.updateButton(!this.currentVariant.available,window.MinimogStrings.soldOut),this.hideSoldOutAndUnavailableOptions()):(this.updateButton(!0,"",!0),this.setUnavailable()),window.MinimogEvents.emit(`${this.productId}__VARIANT_CHANGE`,this.currentVariant,this)}getDataImageVariant(variantId){this.variantGroupImages&&this.variantGroupImages.enable&&(this.currentVariantMedia=this.variantGroupImages.mapping.find(variant=>Number(variant.id)===variantId)&&this.variantGroupImages.mapping.find(variant=>Number(variant.id)===variantId).media)}getProductJson(){return fetch(this.productUrl+".js").then(response=>response.ok?response.json():JSON.parse(this.productWrapper.querySelector("#productData[type='application/json']").textContent)).catch(err=>console.log(err))}getSelectedVariant(){let variant=getVariantFromOptionArray(this.productData,this.options),options=[...this.options];variant||(options.pop(),variant=getVariantFromOptionArray(this.productData,options),variant||(options.pop(),variant=getVariantFromOptionArray(this.productData,options)),this.options=[...variant.options],this.updateSelectedOptions()),this.currentVariant=variant}getSelectedOptions(){const pickerFields=Array.from(this.querySelectorAll("[data-picker-field]"));this.options=pickerFields.map(field=>field.dataset.pickerField==="radio"?Array.from(field.querySelectorAll("input")).find(radio=>radio.checked).value:field.querySelector("select").value)}updateSelectedOptions(){this.domNodes.pickerFields.forEach((field,index)=>{if(field.dataset.selectedValue!==this.options[index]){const selectedOption=field.querySelector(`input[value="${this.options[index].replace(/["\\]/g,"\\$&")}"]`);selectedOption&&(selectedOption.checked=!0,field.updateSelectedValue())}})}updateMedia(){if(!this.currentVariant)return;let mainItems=[],navItems=[],index=0,index0=0,indexNav=0,indexNav0=0;if(this.variantGroupImages&&this.variantGroupImages.enable)if(this.media.mediaMode==="slider"&&this.slides)this.slides.forEach(slide=>{const dataIdMedia=slide.querySelector("[data-media-id]").dataset.mediaId;this.currentVariantMedia&&this.currentVariantMedia.length>0?(this.currentVariantMedia.includes(dataIdMedia)&&(slide.dataset.swiperSlideIndex=index++,slide.dataset.index=index0++,slide.dataset.swiperSlideIndex==="0"&&slide.classList.add("swiper-slide-active"),mainItems.push(slide)),slide.classList.contains("media-type-image")||(slide.dataset.swiperSlideIndex=index++,slide.dataset.index=index0++,mainItems.push(slide))):(slide.dataset.swiperSlideIndex=index++,slide.dataset.index=index0++,mainItems.push(slide))}),this.media.slider.removeAllSlides(),this.media.slider.appendSlide(mainItems),this.media.slider.slideToLoop(0),this.media.handleSlideChange(),this.slidesNav&&this.slidesNav.forEach(slide=>{const dataIdMedia=slide.querySelector("[data-media-id]").dataset.mediaId;this.currentVariantMedia.length>0?(this.currentVariantMedia.includes(dataIdMedia)&&(slide.dataset.swiperSlideIndex=indexNav++,slide.dataset.index=indexNav0++,slide.dataset.swiperSlideIndex==="0"&&slide.classList.add("swiper-slide-thumb-active"),navItems.push(slide)),slide.classList.contains("media-type-image")||(slide.dataset.swiperSlideIndex=indexNav++,slide.dataset.index=indexNav0++,navItems.push(slide))):(slide.dataset.swiperSlideIndex=indexNav++,slide.dataset.index=indexNav0++,slide.classList.remove("swiper-slide-thumb-active"),slide.dataset.swiperSlideIndex==="0"&&slide.classList.add("swiper-slide-thumb-active"),navItems.push(slide))}),this.media.navSlider&&this.media.navSlider.removeAllSlides(),this.media.navSlider&&this.media.navSlider.appendSlide(navItems),this.media.navSlider&&this.media.navSlider.slideToLoop(0),this.media&&this.media.removeAttribute("data-media-loading"),this.media&&(this.media.firstElementChild.style.opacity=1);else{let index2=0;const mediaWraper=this.media.querySelector(".m-product-media--list");this.mediaItems.forEach(item=>{const dataIdMedia=item.querySelector("[data-media-id]").dataset.mediaId;this.currentVariantMedia.length>0?(this.currentVariantMedia.includes(dataIdMedia)&&(item.dataset.index=index2++,mainItems.push(item)),item.classList.contains("media-type-image")||(item.dataset.index=index2++,mainItems.push(item))):(item.dataset.index=index2++,mainItems.push(item)),mediaWraper.innerHTML="",mainItems.forEach(item2=>{mediaWraper.append(item2)})}),this.media&&this.media.removeAttribute("data-media-loading"),this.media&&(this.media.firstElementChild.style.opacity=1)}else parseInt(this.media&&this.media.dataset.mediaSize)>0&&this.media.setActiveMedia(this.currentVariant,this.media);const customData=[];mainItems.length>0&&mainItems.forEach((media,index2)=>{if(media.dataset.mediaType==="image"){const mediaData=media.querySelector(".m-product-media").dataset;customData.push({src:mediaData.mediaSrc,width:parseInt(mediaData.mediaWidth),height:parseInt(mediaData.mediaHeight),alt:mediaData.mediaAlt,id:media.dataset.index})}else customData.push({html:`<div class="pswp__${media.dataset.mediaType}">${media.innerHTML}</div>`,type:media.dataset.mediaType,id:media.dataset.index})}),this.media&&this.media.lightbox&&this.media.lightbox.destroy(),this.media&&this.media.handlePhotoswipe(customData),this.media&&this.media.initPhotoswipe()}updateBrowserHistory(){!this.currentVariant||this.dataset.updateUrl==="false"||window.history.replaceState({},"",`${this.productUrl}?variant=${this.currentVariant.id}`)}updateVariantInput(){document.querySelectorAll(`#product-form-${this.sectionId}, #product-form-installment`).forEach(productForm=>{const variantIdInput=productForm.querySelector(this.selectors.variantIdInput);variantIdInput.value=this.currentVariant.id,variantIdInput.dispatchEvent(new Event("change",{bubbles:!0}))})}updatePickupAvailability(){const pickUpAvailability=this.section.querySelector("pickup-availability");pickUpAvailability&&(this.currentVariant&&this.currentVariant.available?pickUpAvailability.fetchAvailability(this.currentVariant.id):(pickUpAvailability.removeAttribute("available"),pickUpAvailability.innerHTML=""))}removeErrorMessage(){const section=this.closest("section");if(!section)return;const productForm=section.querySelector("product-form");productForm&&productForm.handleErrorMessage()}updatePrice(){const classes={onSale:"m-price--on-sale",soldOut:"m-price--sold-out"},selectors={priceWrapper:".m-price",salePrice:".m-price-item--sale",compareAtPrice:[".m-price-item--regular"],unitPrice:".m-price__unit",unitPriceWrapper:".m-price__unit-wrapper",saleBadge:".m-price__badge-sale",saleAmount:"[data-saved-price]"},mainProductPrices=this.productInfo.querySelector(".main-product__block-price");if(!mainProductPrices)return;const money_format=window.MinimogSettings.money_format,{priceWrapper,salePrice,unitPrice,compareAtPrice,saleBadge,saleAmount,unitPriceWrapper}=queryDomNodes(selectors,mainProductPrices),{compare_at_price,price,unit_price_measurement}=this.currentVariant,saleBadgeType=priceWrapper.dataset.saleBadgeType,onSale=compare_at_price&&compare_at_price>price,soldOut=!this.currentVariant.available;if(onSale?priceWrapper.classList.add(classes.onSale):priceWrapper.classList.remove(classes.onSale),soldOut?priceWrapper.classList.add(classes.soldOut):priceWrapper.classList.remove(classes.soldOut),priceWrapper&&priceWrapper.classList.remove("visibility-hidden"),salePrice&&(salePrice.innerHTML=formatMoney(price,money_format)),compareAtPrice.length&&compare_at_price>price?compareAtPrice.forEach(item=>item.innerHTML=formatMoney(compare_at_price,money_format)):compareAtPrice.forEach(item=>item.innerHTML=formatMoney(price,money_format)),saleBadge&&compare_at_price>price&&saleBadgeType!=="text"){let value;if(saleBadgeType==="fixed_amount")value=formatMoney(compare_at_price-price,money_format);else{const saving=(compare_at_price-price)*100/compare_at_price;value=Math.round(saving)+"%"}saleAmount.innerHTML=value}if(unit_price_measurement&&unitPrice){unitPriceWrapper.classList.remove("m:hidden");const unitPriceContent=`<span>${formatMoney(this.currentVariant.unit_price,money_format)}</span>/<span data-unit-price-base-unit>${this._getBaseUnit()}</span>`;unitPrice.innerHTML=unitPriceContent}else unitPriceWrapper.classList.add("m:hidden")}_getBaseUnit=()=>this.currentVariant.unit_price_measurement.reference_value===1?this.currentVariant.unit_price_measurement.reference_unit:this.currentVariant.unit_price_measurement.reference_value+this.currentVariant.unit_price_measurement.reference_unit;updateButton(disable=!0,text,modifyClass=!0){const productForms=document.querySelectorAll(`.product-form-${this.sectionId}`);productForms&&productForms.forEach(productForm=>{const addButton=productForm.querySelector('[name="add"]'),dynamicCheckout=productForm.querySelector(".m-product-dynamic-checkout"),addButtonText=productForm.querySelector('[name="add"] > .m-add-to-cart--text');addButton&&(disable?(addButton.setAttribute("disabled","disabled"),addButton.classList.add("disabled"),dynamicCheckout&&dynamicCheckout.classList.add("disabled"),text&&(addButtonText.textContent=text)):(addButton.removeAttribute("disabled"),addButton.classList.remove("disabled"),dynamicCheckout&&dynamicCheckout.classList.remove("disabled"),addButtonText.textContent=window.MinimogStrings.addToCart))})}updateProductMeta(){const{available,sku}=this.currentVariant,{inStock,outOfStock}=window.MinimogStrings,productAvailability=this.section.querySelector(this.selectors.productAvailability),productSku=this.section.querySelector(this.selectors.productSku);if(productSku&&(sku?productSku.textContent=sku:productSku.textContent="N/A"),productAvailability){const method=available?"remove":"add";productAvailability.textContent=available?inStock:outOfStock,productAvailability.classList[method]("m-product-availability--outofstock")}}setUnavailable(){const button=document.getElementById(`product-form-${this.sectionId}`),addButton=button.querySelector('[name="add"]'),addButtonText=button.querySelector('[name="add"] > span.m-add-to-cart--text'),priceWrapper=this.section.querySelector(".m-price");addButton&&(addButtonText.textContent=window.MinimogStrings.unavailable,priceWrapper&&priceWrapper.classList.add("visibility-hidden"))}hideSoldOutAndUnavailableOptions=()=>{const classes={soldOut:"m-product-option--node__soldout",unavailable:"m-product-option--node__unavailable"},variant=this.currentVariant,{optionNodes}=this.domNodes,{productData,productData:{variants,options:{length:maxOptions}}}=this;optionNodes.forEach(optNode=>{const{optionPosition,value}=optNode.dataset,optPos=Number(optionPosition),isSelectOption=optNode.tagName==="OPTION";let matchVariants=[];if(optPos===maxOptions){const optionsArray=Array.from(variant.options);optionsArray[maxOptions-1]=value,matchVariants.push(getVariantFromOptionArray(productData,optionsArray))}else matchVariants=variants.filter(v=>v.options[optPos-1]===value&&v.options[optPos-2]===variant[`option${optPos-1}`]);if(matchVariants=matchVariants.filter(Boolean),matchVariants.length){optNode.classList.remove(classes.unavailable),isSelectOption&&optNode.removeAttribute("disabled");const method=matchVariants.every(v=>v.available===!1)?"add":"remove";optNode.classList[method](classes.soldOut)}else optNode.classList.add(classes.unavailable),isSelectOption&&optNode.setAttribute("disabled","true")})};getVariantData(){return this.variantData=this.variantData||JSON.parse(this.container.querySelector('#productVariants[type="application/json"]').textContent),this.variantData}getVariantGroupImageData(){return this.variantGroupImages=this.variantGroupImages||JSON.parse(this.container.querySelector('#variantGroup[type="application/json"]').textContent),this.variantGroupImages}initOptionSwatches(){const{_colorSwatches=[],_imageSwatches=[]}=window.MinimogSettings;this.domNodes.optionNodes&&this.domNodes.optionNodes.forEach(optNode=>{const{optionType,optionPosition,value:optionValue}=optNode.dataset,optionValueLowerCase=optionValue.toLowerCase(),variantToShowSwatchImage=this.variantData.find(v=>v[`option${optionPosition}`]===optionValue),variantImage=variantToShowSwatchImage&&variantToShowSwatchImage.featured_image&&variantToShowSwatchImage.featured_image.src?getSizedImageUrl(variantToShowSwatchImage.featured_image.src,"100x"):variantToShowSwatchImage.featured_image?variantToShowSwatchImage.featured_image.src:null,customImage=_imageSwatches.find(i=>i.key===optionValueLowerCase)?_imageSwatches.find(i=>i.key===optionValueLowerCase).value:"",customColor=_colorSwatches.find(c=>c.key===optionValueLowerCase)?_colorSwatches.find(c=>c.key===optionValueLowerCase).value:"";switch((variantImage||customImage)&&optNode.querySelector("label")&&optNode.querySelector("label").classList.add("has-bg-img"),optionType){case"default":optNode.querySelector("label").style.backgroundImage=`url(${customImage||variantImage||""})`,optNode.querySelector("label").classList.remove("option-loading");break;case"image":optNode.querySelector("label").style.backgroundImage=`url(${variantImage||customImage||""})`,optNode.querySelector("label").classList.remove("option-loading");break;case"color":optNode.querySelector("label").style.backgroundColor=customColor||optionValueLowerCase,customImage&&(optNode.querySelector("label").style.backgroundImage=`url(${customImage})`),optNode.querySelector("label").classList.remove("option-loading");break;default:break}})}}customElements.define("variant-picker",VariantPicker)}if(!customElements.get("variant-button")){class VariantButton extends HTMLElement{constructor(){super(),this.selectedSpan=this.querySelector(".option-label--selected"),this.addEventListener("change",this.updateSelectedValue)}updateSelectedValue(){this.value=Array.from(this.querySelectorAll("input")).find(radio=>radio.checked).value,this.setAttribute("data-selected-value",this.value),this.selectedSpan&&(this.selectedSpan.textContent=this.value)}}if(customElements.define("variant-button",VariantButton),!customElements.get("variant-select")){class VariantSelect extends VariantButton{constructor(){super()}updateSelectedValue(){this.value=this.querySelector("select").value,this.setAttribute("data-selected-value",this.value),this.selectedSpan&&(this.selectedSpan.textContent=this.value)}}customElements.define("variant-select",VariantSelect)}if(!customElements.get("variant-image")){class VariantImage extends VariantButton{constructor(){super()}}customElements.define("variant-image",VariantImage)}if(!customElements.get("variant-color")){class VariantColor extends VariantButton{constructor(){super()}}customElements.define("variant-color",VariantColor)}}
//# sourceMappingURL=/cdn/shop/t/5/assets/variant-picker.js.map?v=125944483717640190741728918271
